name: Test workflow to remove issues from a project

on:
  issues:
    types:
      - unlabeled

jobs:
  remove-from-project:
    runs-on: ubuntu-latest
    if: |
      github.event.label.name == 'enhancement' 
    steps:
      - name: Get issue id from project
        id: get_issue_id_from_project
        env:
          GITHUB_TOKEN: ${{ secrets.TMP_ACCESS }}
          ISSUE_ID: ${{ github.event.issue.node_id }}
          PROJECT_ID: "PVT_kwHN0jbOABe9dA"
        run: |
          item_id="$( gh api graphql -f query='
            mutation($project:ID!, $pr:ID!) {
              addProjectV2ItemById(input: {projectId: $project, contentId: $pr}) {
                item {
                  id
                }
              }
            }' -f project=$PROJECT_ID -f issue=$ISSUE_ID --jq '.data.addProjectV2ItemById.item.id')"

          gh api graphql -f query='
            mutation remove_from_project($projectid:ID!,$itemid:ID!) {
              deleteProjectV2Item(input: {projectId: $project itemId: item}) {
                deletedItemId
              }
            }' -f project=$PROJECT_ID -f item=$item_id
